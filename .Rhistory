library(tidyverse)
library(magrittr)
library(terra)
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc")
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
names()
lubridate::date("1900-01-01")
lubridate::date("1900-01-01") + 31046
31046 + lubridate::date("1900-01-01")
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
)
?terra
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01")) %>%
lubridate::month()
)
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
)
sf::st_transform(mcor::mt_state_simple, 4326)
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326))
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc")
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326)) %>%
terra::tapp(., index = lubridate::month(names(.)), fun = mean)
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326)) %>%
terra::tapp(., index = month.name[lubridate::month(names(.))], fun = mean)
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326))
{lubridate::month(names(.))}
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326))
{lubridate::month(names(.x))}
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326)) %>%
names()
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326)) %>%
names() %>%
lubridate::month()
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326)) %>%
terra::tapp(., index = month.name[lubridate::month(names(.))], fun = mean)
test <-
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326)) %>%
terra::tapp(.,
index = month.name[lubridate::month(names(.))],
fun = mean)
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326)) %>%
terra::tapp(.,
index = paste0("1985-",lubridate::month(names(.))),
fun = mean)
test <-
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326)) %>%
terra::tapp(.,
index = paste0("1985-",lubridate::month(names(.))),
fun = mean)
plot(test[["X1985.1"]])
plot(test[["X1985.2"]])
plot(test[["X1985.3"]])
plot(test[["X1985.4"]])
plot(test[["X1985.5"]])
plot(test[["X1985.6"]])
plot(test[["X1985.7"]])
plot(test[["X1985.8"]])
plot(test[["X1985.9"]])
plot(test[["X1985.10"]])
plot(test[["X1985.11"]])
plot(test[["X1985.12"]])
test <-
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326))
test
names(test)
terra::rast("~/Desktop/gridmet/vs/vs_1985.nc") %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326)) %>%
terra::tapp(.,
index = paste0("1985-",lubridate::month(names(.))),
fun = mean)
process_year <- function(year){
the_rast <-
terra::rast(paste0("~/Desktop/gridmet/vs/vs_",year,".nc")) %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326))
list(mean, max) %>%
purrr::map(~terra::tapp(the_rast,
index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = .x))
}
process_year(1985)
process_year(2020)
process_year <- function(year){
the_rast <-
terra::rast(paste0("~/Desktop/gridmet/vs/vs_",year,".nc")) %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326))
list(mean, max) %>%
purrr::map(~terra::tapp(the_rast,
index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = .x)) %>%
magrittr::set_names(c("mean", "max"))
}
process_year(2020)
1979:2020 %>%
magrittr::set_names(.,.)
1979:2020 %>%
magrittr::set_names(.,.) %>%
purrr::map(process_year)
count_windy <- function(x){
sum(x > 20)
}
process_year <- function(year){
the_rast <-
terra::rast(paste0("~/Desktop/gridmet/vs/vs_",year,".nc")) %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326))
list(mean, max, count_windy) %>%
purrr::map(~terra::tapp(the_rast,
index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = .x)) %>%
magrittr::set_names(c("mean", "max", "count_windy"))
}
process_year(2020)
units::set_units(20, "mi/hr") %>% units::set_units("m/s")
windy_thresh <-
units::set_units(20, "mi/hr") %>%
units::set_units("m/s") %>%
units::drop_units()
windy_thresh
count_windy <- function(x){
sum(x >= windy_thresh)
}
process_year(2020)
count_windy <-
function(x){
sum(x >= windy_thresh,
na.rm = TRUE)
}
process_year <- function(year){
the_rast <-
terra::rast(paste0("~/Desktop/gridmet/vs/vs_",year,".nc")) %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326))
list(mean, max, count_windy) %>%
purrr::map(~terra::tapp(the_rast,
index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = .x)) %>%
magrittr::set_names(c("mean", "max", "count_windy"))
}
process_year(2020)
process_year(2020)$count_windy[["X2020.1"]] %>% plot()
year <- 2020
the_rast <-
terra::rast(paste0("~/Desktop/gridmet/vs/vs_",year,".nc")) %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326))
the_rast[the_rast >= windy_thresh]
the_rast >= windy_thresh
terra::global(the_rast,count_windy )
terra::app(the_rast,count_windy )
terra::tapp(the_rast,
index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = count_windy)
stringr::str_detect(names(the_rast),"2000-01")
the_rast
stringr::str_detect(names(the_rast),"2020-01")
the_rast[[stringr::str_detect(names(the_rast),"2020-01")]]
terra::app(the_rast[[stringr::str_detect(names(the_rast),"2020-01")]],
count_windy)
terra::tapp(the_rast,
index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = mean)
the_rast[[stringr::str_detect(names(the_rast),"2020-01")]]
terra::app(the_rast[[stringr::str_detect(names(the_rast),"2020-01")]],
count_windy)
terra::app(the_rast[[stringr::str_detect(names(the_rast),"2020-01")]],
mean)
terra::tapp(the_rast,
index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = mean)
terra::tapp(the_rast,
index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = max)
terra::app(the_rast[[stringr::str_detect(names(the_rast),"2020-01")]],
max)
terra::tapp(the_rast,
index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = count_windy)
terra::app(the_rast[[stringr::str_detect(names(the_rast),"2020-01")]],
count_windy)
count_windy <-
function(x){
sum(x >= windy_thresh)
}
terra::app(the_rast[[stringr::str_detect(names(the_rast),"2020-01")]],
count_windy)
(the_rast >= windy_thresh) %>%
terra::tapp(index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = sum)
list(mean, max) %>%
purrr::map(~terra::tapp(the_rast,
index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = .x))  %>%
c(
(the_rast >= windy_thresh) %>%
terra::tapp(index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = sum)
)
process_year <- function(year){
the_rast <-
terra::rast(paste0("~/Desktop/gridmet/vs/vs_",year,".nc")) %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326))
list(mean, max) %>%
purrr::map(~terra::tapp(the_rast,
index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = .x))  %>%
c(
(the_rast >= windy_thresh) %>%
terra::tapp(index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = sum)
) %>%
magrittr::set_names(c("mean", "max", "windy_days"))
}
library(tidyverse)
library(magrittr)
library(terra)
windy_thresh <-
units::set_units(20, "mi/hr") %>%
units::set_units("m/s") %>%
units::drop_units()
count_windy <-
function(x){
sum(x >= windy_thresh)
}
process_year <- function(year){
the_rast <-
terra::rast(paste0("~/Desktop/gridmet/vs/vs_",year,".nc")) %>%
magrittr::set_names(.,
names(.) %>%
stringr::str_remove("wind_speed_day=") %>%
as.integer() %>%
magrittr::add(lubridate::date("1900-01-01"))
) %>%
terra::crop(sf::st_transform(mcor::mt_state_simple, 4326))
list(mean, max) %>%
purrr::map(~terra::tapp(the_rast,
index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = .x))  %>%
c(
(the_rast >= windy_thresh) %>%
terra::tapp(index = paste0(year, "-", lubridate::month(names(the_rast))),
fun = sum)
) %>%
magrittr::set_names(c("mean", "max", "windy_days"))
}
montana_wind <-
1979:2020 %>%
magrittr::set_names(.,.) %>%
purrr::map(process_year)
montana_wind
library(rgee)
library(reticulate)
library(mcor)
library(magrittr)
ee_Initialize()
# # 2. Install geemap in the same Python ENV that use rgee
# py_install("geemap")
# gm <- import("geemap")
blackfeet <- mcor::mt_tribal_land %>%
dplyr::filter(Name == "Blackfeet") %>%
sf::st_transform(4326) %>%
dplyr::rename(geometry = SHAPE)
gridmet_wind <-
ee$ImageCollection("IDAHO_EPSCOR/GRIDMET") %>%
ee$ImageCollection$filterDate("1979-01-01", "1980-12-31") %>%
ee$ImageCollection$map(function(x) x$select("vs"))
blackfeet_max_wind <-
purrr::map(1979:2022,
~ee_extract(x = ee$ImageCollection("IDAHO_EPSCOR/GRIDMET") %>%
ee$ImageCollection$filterDate(paste0(.x,"-01-01"), paste0(.x,"-12-31")) %>%
ee$ImageCollection$map(function(x) x$select("vs")),
y = blackfeet,
fun = ee$Reducer$max())
)
blackfeet_max_wind_processed <-
blackfeet_max_wind %>%
dplyr::bind_rows() %>%
tidyr::pivot_longer(-Name,
names_to = "Date",
values_to = "Wind Speed") %>%
dplyr::mutate(Date =
stringr::str_remove(Date, "X") %>%
stringr::str_remove("_vs") %>%
lubridate::as_date(),
`Wind Speed` = units::set_units(`Wind Speed`, "m/s") %>%
units::set_units("mi/hr"))
blackfeet_max_wind_processed_monthly <-
blackfeet_max_wind_processed %>%
dplyr::group_by(Year = lubridate::year(Date),
Month = factor(month.abb[lubridate::month(Date)],
ordered = TRUE,
levels = month.abb)) %>%
dplyr::summarise(`Mean Wind Speed` = mean(`Wind Speed`, na.rm = TRUE),
`Max Wind Speed` = max(`Wind Speed`, na.rm = TRUE),
`Windy Days` = sum(`Wind Speed` >= units::set_units(20,"mi/hr"), na.rm = TRUE))
blackfeet_max_wind_processed_monthly
blackfeet_max_wind_processed_monthly %>%
readr::write_csv("~/Desktop/blackfeet_wind.csv")
blackfeet_max_wind_processed_monthly %>%
dplyr::rename(`Mean Wind Speed (mi/hr)` = `Mean Wind Speed`,
`Max Wind Speed (mi/hr)` = `Max Wind Speed`)
blackfeet_max_wind_processed_monthly %>%
dplyr::rename(`Mean Wind Speed (mi/hr)` = `Mean Wind Speed`,
`Max Wind Speed (mi/hr)` = `Max Wind Speed`) %>%
readr::write_csv("~/Desktop/blackfeet_wind.csv")
?write_csv
blackfeet_max_wind_processed_monthly %>%
dplyr::rename(`Mean Wind Speed (mi/hr)` = `Mean Wind Speed`,
`Max Wind Speed (mi/hr)` = `Max Wind Speed`) %>%
dplyr::mutate(dplyr::across(`Mean Wind Speed (mi/hr)`:`Max Wind Speed (mi/hr)`,
round,
digits = 2))
blackfeet_max_wind_processed_monthly %>%
dplyr::rename(`Mean Wind Speed (mi/hr)` = `Mean Wind Speed`,
`Max Wind Speed (mi/hr)` = `Max Wind Speed`) %>%
dplyr::mutate(dplyr::across(`Mean Wind Speed (mi/hr)`:`Max Wind Speed (mi/hr)`,
round,
digits = 2)) %>%
readr::write_csv("~/Desktop/blackfeet_wind.csv")
